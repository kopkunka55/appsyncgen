import { util } from '@aws-appsync/utils';

export function request(ctx) {
  const { input } = ctx.args;
  const updatedAt = util.time.nowISO8601();
    return {
      operation: 'UpdateItem',
      key: util.dynamodb.toMapValues({PK: `{{ .PK }}#${input.id}`,SK: `{{ .SK }}#${input.id}`}),
      update: {
        expression: "SET {{ range .Attributes }} {{ . }} = :{{ . }},{{ end }} updatedAt = :updatedAt",
        expressionValues: util.dynamodb.toMapValues({
          {{ range .Attributes }}
          ':{{ . }}' : input.{{ . }},
          {{ end }}
          ':updatedAt': updatedAt
        })
      }
    }
}

export function response(ctx){
  const { result } = ctx;
  if (ctx.error){
    util.error(ctx.error.message, ctx.error.type, ctx.result)
  }
  return {
    {{ .PK | toLowerCase}}ID: ctx.result.id,
    ...ctx.result,
  }
}
